import{N as E,r as c,j as e,u as M,g as j,h as _}from"./index-DJgBPc4Q.js";import{S as O}from"./SideBar-Dfc0aK0a.js";import{o as P,c as U,e as f,a as u}from"./index.esm-CZuSFxBQ.js";import{u as q}from"./index.esm-ChsSJTbT.js";import{h as B}from"./index.esm-Bdq_nA-h.js";import{c as z}from"./index-BrykQlq8.js";import{u as K}from"./useModal-BpbXFQEG.js";import{R as Q}from"./quill.snow-Dd97b27R.js";import"./index-BzVWIOBD.js";import"./isEqual-CwlUOuli.js";function V(o){return E({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M1,17 L1,23 L23,23 L23,17 M12,2 L12,19 M5,9 L12,2 L19,9"},child:[]}]})(o)}const W=({value:o})=>{const[x,d]=c.useState("");return c.useEffect(()=>{d(o)},[o]),e.jsx(Q,{value:x,onChange:p=>{d(p)},className:"flex flex-col w-2/3 h-full",readOnly:!1,modules:{toolbar:!1}})},J=U({restaurantName:u().required("매장명은 필수입력 항목입니다"),restaurantAddress:u().required("매장주소는 필수입력 항목입니다"),restaurantNumber:u().required("전화번호는 필수입력 항목입니다"),startTime:u(),endTime:u(),status:f(),maxCapacity:f(),lat:f(),lng:f()}),X=()=>{var b;const[o,x]=c.useState([]),[d,p]=c.useState([]),[Y,Z]=c.useState(!1),[w,y]=c.useState({}),[r,v]=c.useState({}),h=sessionStorage.getItem("restaurantId"),{Modal:I,open:g,close:C}=K({title:"주소검색"}),k=M(),{register:i,handleSubmit:S,setValue:l,formState:{errors:T}}=q({resolver:P(J),defaultValues:{restaurantName:r.restaurantName,restaurantAddress:"",restaurantNumber:"",restaurantDescription:"",status:0,maxCapacity:0},mode:"onChange"}),F=async()=>{try{const s={restaurantId:h},t=await j.get("/api/restaurant",{params:s});console.log(t),console.log(t.data.resultData);const a=t.data.resultData;v(a)}catch(s){console.log(s)}};c.useEffect(()=>{F()},[]),c.useEffect(()=>{if(r&&r.operatingHours){const[s,t]=r.operatingHours.split("~").map(a=>a.trim());l("startTime",s),l("endTime",t)}l("lat",r.lat),l("lng",r.lng),l("restaurantName",r.restaurantName),l("restaurantDescription",r.restaurantDescription),l("restaurantAddress",r.restaurantAddress),l("restaurantNumber",r.restaurantNumber),l("operatingHours",r.operatingHours),l("maxCapacity",r.maxCapacity),l("status",r.status),console.log(r.status)},[r]);const A=s=>{const t=s.target.files;console.log(t);const a=[...t];x([...a]);const n=a.map(m=>URL.createObjectURL(m));p([...n])};console.log(d),console.log("요거다!!!!!!!",o);const D=s=>{const t=d.indexOf(s);if(t===-1)return;const a=o.filter((m,N)=>N!==t),n=d.filter((m,N)=>N!==t);x(a),p(n),console.log(o)},G=async s=>{try{const a=await(await fetch(`https://dapi.kakao.com/v2/local/search/address.json?query=${encodeURIComponent(s)}`,{headers:{Authorization:"KakaoAK c39062d8559862a0fe376de133d3af0c"}})).json();if(a.documents.length>0){const{x:n,y:m}=a.documents[0];l("lat",m),l("lng",n)}}catch(t){console.error("Error fetching coordinates:",t)}},L=async s=>{console.log(s);let t=s.address,a="";const n=s.zonecode;s.addressType==="R"&&(s.bname!==""&&(a+=s.bname),s.buildingName!==""&&(a+=a!==""?`, ${s.buildingName}`:s.buildingName),t+=a!==""?` (${a})`:""),await G(t),C(),y({fullAddress:t,zoneCode:n}),console.log(t),l("restaurantAddress",t)},R=async s=>{try{await j.patch("/api/restaurant",s),_.fire({title:"매장 정보가 수정되었습니다.",icon:"success",confirmButtonText:"확인",showConfirmButton:!0,allowOutsideClick:!1}).then(t=>{t.isConfirmed&&k("/store")})}catch(t){console.log(t)}},$=async s=>{try{await j.post(`/api/pic/restaurant?restaurantId=${h}`,s,{headers:{"Content-Type":"multipart/form-data"}}),console.log("잘 들어왔다 이미지!!!!!!!"),console.log("이미지 데이터",s)}catch(t){console.log(t),console.log("이미지 데이터",s)}},H=s=>{const t=`${s.startTime} ~ ${s.endTime}`;console.log(t);const a={restaurantId:parseInt(h),restaurantName:s.restaurantName,restaurantAddress:s.restaurantAddress,restaurantNumber:s.restaurantNumber,operatingHours:t,restaurantDescription:s.restaurantDescription,status:s.status,maxCapacity:s.maxCapacity,lat:s.lat,lng:s.lng},n=new FormData;o.map(m=>{n.append("filePath",m)}),console.log("ImgData 확인:",[...n.entries()]),$(n),R(a),console.log("patchStoreData!!!!!!!!!",a),console.log(s)};return e.jsx("div",{className:"flex w-[calc(100%_-_11rem)] h-full bg-gray justify-center items-center",children:e.jsx("div",{className:"flex w-[96.5%] h-[calc(100%_-_4rem)] bg-white rounded-lg overflow-hidden overflow-y-scroll scrollbar-hide",children:e.jsx("form",{className:"flex w-full justify-evenly",onSubmit:S(H),children:e.jsxs("div",{className:"flex flex-col w-full h-full p-10 gap-6",children:[e.jsx("span",{className:"text-2xl",children:"매장정보 수정"}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsxs("label",{htmlFor:"inputImg",className:"flex flex-col w-36 h-32 border border-darkGray items-center justify-center gap-2 cursor-pointer",children:[e.jsx(V,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"이미지 업로드"}),e.jsx("span",{className:"text-sm",children:"최대 6개까지"})]}),e.jsx("input",{type:"file",id:"inputImg",multiple:!0,onChange:s=>A(s),accept:"image/png, image/jpeg",className:"hidden"}),e.jsx("div",{className:"flex w-[80%] gap-2 justify-start",children:d.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute flex p-1 text-3xl right-0.5 text-black cursor-pointer",onClick:()=>D(s)}),e.jsx("img",{src:s,alt:"",className:"w-32 h-32"})]},t))})]}),e.jsxs("div",{className:"flex w-1/2 gap-11 items-center",children:[e.jsx("span",{className:"text-darkGray",children:"가게 이름"}),e.jsx("input",{type:"text",className:"border-b px-2 max-w-48 outline-none",...i("restaurantName")})]}),e.jsxs("div",{className:"flex w-full h-full gap-11 items-center",children:[e.jsx("span",{className:"text-darkGray",children:"가게 설명"}),e.jsx(W,{value:r.restaurantDescription})]}),e.jsxs("div",{className:"flex flex-col w-[45%] gap-2",children:[e.jsxs("div",{className:"flex gap-11",children:[e.jsx("label",{htmlFor:"",className:"text-nowrap text-darkGray",children:"전화 번호"}),e.jsx("input",{type:"tel",maxLength:12,className:"border-b px-2 w-40 outline-none",placeholder:"00(0)-000(0)-0000",...i("restaurantNumber")})]}),e.jsx("p",{className:"text-red w-60",children:(b=T.restaurantNumber)==null?void 0:b.message})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2",children:[e.jsx("label",{className:"text-darkGray block",children:"주소"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",className:"border rounded-md px-2 w-60",onClick:()=>g(),value:w?w.fullAddress:"",...i("restaurantAddress")}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded-md",onClick:()=>g(),children:"주소찾기"})]}),g?e.jsx(I,{children:e.jsx(B,{onComplete:s=>L(s)})}):e.jsx(e.Fragment,{})]}),e.jsxs("div",{className:"flex w-[45%] gap-4",children:[e.jsx("label",{htmlFor:"",className:"text-nowrap text-darkGray",children:"최대 수용인원"}),e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"number",className:"border px-2 rounded-md w-12 text-end",...i("maxCapacity")}),e.jsx("span",{children:"명"})]})]}),e.jsxs("div",{className:"flex w-full",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-2",children:[e.jsx("label",{htmlFor:"",className:"w-[15%] text-nowrap text-darkGray",children:"영업 시간"}),e.jsxs("div",{className:"flex gap-[15px] w-60",children:[e.jsx("label",{htmlFor:"openTime",children:"오픈시간"}),e.jsx("input",{type:"time",id:"openTime",className:"w-[130px] border px-2 rounded-md",...i("startTime")})]}),e.jsxs("div",{className:"flex gap-[15px] w-60",children:[e.jsx("label",{htmlFor:"closedTime",children:"마감시간"}),e.jsx("input",{type:"time",id:"closedTime",className:"w-[130px] border px-2 rounded-md",...i("endTime")})]})]}),e.jsxs("fieldset",{className:"flex w-1/2",children:[e.jsx("legend",{htmlFor:"",className:"w-[15%] text-nowrap text-darkGray",children:"영업 상태"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:"open",className:"border px-2 rounded-md",value:0,...i("status")}),e.jsx("label",{htmlFor:"open",className:"w-16",children:"영업중"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:"break",className:"border px-2 rounded-md",value:1,...i("status")}),e.jsx("label",{htmlFor:"break",className:"w-28",children:"브레이크타임"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",id:"closed",className:"border px-2 rounded-md",value:2,...i("status")}),e.jsx("label",{htmlFor:"closed",className:"w-20",children:"영업종료"})]})]})]}),e.jsx("div",{className:"flex flex-col w-[45%] gap-2",children:e.jsx("div",{className:"flex gap-1 items-center",children:e.jsx("button",{className:"bg-primary px-4 py-1 rounded-lg text-white",type:"submit",children:"수정완료"})})})]})})})})},de=()=>e.jsxs("div",{className:"flex w-full h-dvh overflow-hidden scrollbar-hide justify-between",children:[e.jsx(O,{}),e.jsx(X,{})]});export{de as default};
