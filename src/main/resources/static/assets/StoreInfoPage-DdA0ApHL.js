import{r as c,u as E,j as e,b as f,S as M}from"./index-XkiSkCIq.js";import{S as _}from"./SideBar-91HAkM02.js";import{o as P,c as U,e as p,a as m}from"./index.esm-kZtGv46w.js";import{u as q}from"./index.esm-j2erOJPr.js";import{h as B}from"./index.esm-NabwU_Io.js";import{G as O}from"./iconBase-DXw1Gjh5.js";import{a as z}from"./index-CVEDjnF9.js";import{u as K}from"./useModal-BISKceEi.js";import"./index-UaCtCoyR.js";import"./index-DVqpnsV0.js";import"./index-0rdTubEZ.js";import"./roleAtom-ClRng8Ap.js";import"./index-Cu020-X3.js";function V(d){return O({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",strokeWidth:"2",d:"M1,17 L1,23 L23,23 L23,17 M12,2 L12,19 M5,9 L12,2 L19,9"},child:[]}]})(d)}const W=U({restaurantName:m().required("매장명은 필수입력 항목입니다"),restaurantAddress:m().required("매장주소는 필수입력 항목입니다"),restaurantNumber:m().required("전화번호는 필수입력 항목입니다"),startTime:m(),endTime:m(),status:p(),maxCapacity:p(),lat:p(),lng:p()}),J=()=>{var w;const[d,N]=c.useState([]),[u,j]=c.useState([]),[Q,X]=c.useState(!1),[b,y]=c.useState({}),[r,v]=c.useState({}),x=sessionStorage.getItem("restaurantId"),{Modal:I,open:g,close:C}=K({title:"주소검색"}),T=E(),{register:o,handleSubmit:k,setValue:l,formState:{errors:S}}=q({resolver:P(W),defaultValues:{restaurantName:r.restaurantName,restaurantAddress:"",restaurantNumber:"",restaurantDescription:"",status:0,maxCapacity:0},mode:"onChange"}),A=async()=>{try{const s={restaurantId:x},t=await f.get("/api/restaurant",{params:s});console.log(t),console.log(t.data.resultData);const a=t.data.resultData;v(a)}catch(s){console.log(s)}};c.useEffect(()=>{A()},[]),c.useEffect(()=>{if(r&&r.operatingHours){const[s,t]=r.operatingHours.split("~").map(a=>a.trim());console.log(s,"TTTTTTTT",t),l("startTime",s),l("endTime",t)}l("lat",r.lat),l("lng",r.lng),l("restaurantName",r.restaurantName),l("restaurantDescription",r.restaurantDescription),l("restaurantAddress",r.restaurantAddress),l("restaurantNumber",r.restaurantNumber),l("operatingHours",r.operatingHours),l("maxCapacity",r.maxCapacity),l("status",r.status),console.log(r.status)},[r]);const D=s=>{const t=s.target.files;console.log(t);const a=[...t];N([...a]);const n=a.map(i=>URL.createObjectURL(i));j([...n])};console.log(u),console.log("요거다!!!!!!!",d);const F=s=>{const t=u.indexOf(s);if(t===-1)return;const a=d.filter((i,h)=>h!==t),n=u.filter((i,h)=>h!==t);N(a),j(n)},G=async s=>{try{const a=await(await fetch(`https://dapi.kakao.com/v2/local/search/address.json?query=${encodeURIComponent(s)}`,{headers:{Authorization:"KakaoAK c39062d8559862a0fe376de133d3af0c"}})).json();if(a.documents.length>0){const{x:n,y:i}=a.documents[0];l("lat",i),l("lng",n)}}catch(t){console.error("Error fetching coordinates:",t)}},L=async s=>{console.log(s);let t=s.address,a="";const n=s.zonecode;s.addressType==="R"&&(s.bname!==""&&(a+=s.bname),s.buildingName!==""&&(a+=a!==""?`, ${s.buildingName}`:s.buildingName),t+=a!==""?` (${a})`:""),await G(t),C(),y({fullAddress:t,zoneCode:n}),console.log(t),l("restaurantAddress",t)},$=async s=>{try{await f.patch("/api/restaurant",s),M.fire({title:"매장 정보가 수정되었습니다.",icon:"success",confirmButtonText:"확인",showConfirmButton:!0,allowOutsideClick:!1}).then(t=>{t.isConfirmed&&T("/store")})}catch(t){console.log(t)}},H=async s=>{try{await f.post(`/api/pic/restaurant?restaurantId=${x}`,s,{headers:{"Content-Type":"multipart/form-data"}}),console.log("잘 들어왔다 이미지!!!!!!!"),console.log("이미지 데이터",s)}catch(t){console.log(t),console.log("이미지 데이터",s)}},R=s=>{const t=`${s.startTime} ~ ${s.endTime}`;console.log(t);const a={restaurantId:parseInt(x),restaurantName:s.restaurantName,restaurantAddress:s.restaurantAddress,restaurantNumber:s.restaurantNumber,operatingHours:t,restaurantDescription:s.restaurantDescription,status:s.status,maxCapacity:s.maxCapacity,lat:s.lat,lng:s.lng},n=new FormData;d.map(i=>{n.append("filePath",i)}),console.log("ImgData 확인:",[...n.entries()]),H(n),$(a),console.log("patchStoreData!!!!!!!!!",a),console.log(s)};return e.jsx("div",{className:"flex w-[calc(100%_-_11rem)] h-full bg-gray justify-center items-center",children:e.jsx("div",{className:"flex w-[96.5%] h-[calc(100%_-_4rem)] bg-white rounded-lg overflow-hidden overflow-y-scroll scrollbar-hide",children:e.jsx("form",{onSubmit:k(R),children:e.jsxs("div",{className:"flex flex-col w-full h-full p-6 gap-6",children:[e.jsx("span",{className:"text-xl",children:"매장정보 수정"}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsxs("label",{htmlFor:"inputImg",className:"flex flex-col w-48 h-32 border border-darkGray items-center justify-center gap-2 cursor-pointer",children:[e.jsx(V,{className:"w-6 h-6"}),e.jsx("span",{className:"text-lg",children:"이미지 업로드"}),e.jsx("span",{className:"text-sm",children:"최대 6개까지"})]}),e.jsx("input",{type:"file",id:"inputImg",multiple:!0,onChange:s=>D(s),accept:"image/png, image/jpeg",className:"hidden"}),e.jsx("div",{className:"flex w-[90%] gap-2 justify-start",children:u.map((s,t)=>e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute flex p-1 text-3xl right-0.5 text-black cursor-pointer",onClick:()=>F(s)}),e.jsx("img",{src:s,alt:"",className:"border border-darkGray w-32 h-32"})]},t))})]}),e.jsxs("div",{className:"flex gap-9 items-center",children:[e.jsx("span",{className:"text-darkGray",children:"가게 이름"}),e.jsx("input",{type:"text",className:"border px-2 rounded-md w-28",...o("restaurantName")})]}),e.jsxs("div",{className:"flex gap-9 items-center",children:[e.jsx("span",{className:"text-darkGray",children:"가게 설명"}),e.jsx("input",{type:"text",className:"border px-2 rounded-md",...o("restaurantDescription")})]}),e.jsxs("div",{className:"flex flex-col w-[45%] gap-2",children:[e.jsxs("div",{className:"flex gap-9",children:[e.jsx("label",{htmlFor:"",className:"text-nowrap text-darkGray",children:"전화 번호"}),e.jsx("input",{type:"tel",maxLength:12,className:"border px-2 rounded-md w-40",placeholder:"00(0)-000(0)-0000",...o("restaurantNumber")})]}),e.jsx("p",{className:"text-red w-60",children:(w=S.restaurantNumber)==null?void 0:w.message})]}),e.jsxs("div",{className:"flex w-[45%] gap-2",children:[e.jsx("label",{htmlFor:"",className:"text-nowrap text-darkGray",children:"최대 수용인원"}),e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("input",{type:"number",className:"border px-2 rounded-md w-12 text-end",...o("maxCapacity")}),e.jsx("span",{children:"명"})]})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2",children:[e.jsx("label",{className:"text-darkGray block",children:"주소"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",className:"border rounded-md px-2 w-60",onClick:()=>g(),value:b?b.fullAddress:"",...o("restaurantAddress")}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded-md",onClick:()=>g(),children:"주소찾기"})]}),g?e.jsx(I,{children:e.jsx(B,{onComplete:s=>L(s)})}):e.jsx(e.Fragment,{})]}),e.jsxs("div",{className:"flex flex-col w-[45%] gap-2",children:[e.jsx("label",{htmlFor:"",className:"w-[15%] text-nowrap text-darkGray",children:"영업 시간"}),e.jsxs("div",{className:"flex gap-[15px] w-60",children:[e.jsx("span",{children:"오픈시간"}),e.jsx("input",{type:"time",className:"w-[130px] border px-2 rounded-md",...o("startTime")})]}),e.jsxs("div",{className:"flex gap-[15px] w-60",children:[e.jsx("span",{children:"마감시간"}),e.jsx("input",{type:"time",className:"w-[130px] border px-2 rounded-md",...o("endTime")})]})]}),e.jsxs("fieldset",{className:"flex w-[45%]",children:[e.jsx("legend",{htmlFor:"",className:"w-[15%] text-nowrap text-darkGray",children:"영업 상태"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"radio",className:"border px-2 rounded-md",value:0,...o("status")}),e.jsx("label",{htmlFor:"",className:"w-16",children:"영업중"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"radio",className:"border px-2 rounded-md",value:1,...o("status")}),e.jsx("label",{htmlFor:"",className:"w-28",children:"브레이크타임"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"radio",className:"border px-2 rounded-md",value:2,...o("status")}),e.jsx("label",{htmlFor:"",className:"w-20",children:"영업종료"})]})]}),e.jsx("div",{className:"flex flex-col w-[45%] gap-2",children:e.jsx("div",{className:"flex gap-1 items-center",children:e.jsx("button",{className:"bg-primary px-4 py-1 rounded-lg text-white",type:"submit",children:"수정완료"})})})]})})})})},me=()=>e.jsxs("div",{className:"flex w-full h-dvh overflow-hidden scrollbar-hide justify-between",children:[e.jsx(_,{}),e.jsx(J,{})]});export{me as default};
