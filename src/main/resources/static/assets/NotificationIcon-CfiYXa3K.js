import{m as r,a9 as z,r as j,u as F,g as B,j as e,y as G,c as I,d as u,E as $,aa as M}from"./index-ji0Yrnpj.js";import{g as U}from"./index-DPSCt2xo.js";import{n as S,a as P,i as E,p as L,o as R}from"./MenuBar-DGtHK_nx.js";const W=()=>{var l;const[k,C]=r(z),[a,y]=r(S),[t,f]=j.useState({}),[O,m]=r(P),[n,b]=j.useState({}),[w,x]=j.useState(!1),h=F(),p=B(),v=window.sessionStorage.getItem("userId"),i=async s=>{console.log(s);const d={userId:v,orderId:s.orderId,orderUserId:s.orderUserId};try{const o=await I.get("/api/user/user-payment-member/getPaymentInfo",{params:d,headers:{Authorization:`Bearer ${p}`}});console.log(o.data),b(o.data.resultData)}catch(o){console.log(o)}},A=async s=>{console.log(s);const d={orderId:n.orderId,userId:s,approvalStatus:1};console.log(d),m(!1);try{const o=await I.patch("/api/user/user-payment-member",d,{headers:{Authorization:`Bearer ${p}`}});console.log(o.data),x(!1),u.fire({title:"결제가 승인 되었습니다!",icon:"success",confirmButtonText:"확인",showConfirmButton:!0,allowOutsideClick:!1,customClass:{popup:"flex w-[80%]",title:"text-xl text-black"}}).then(T=>{T.isConfirmed&&h("/user")})}catch(o){console.log(o)}},g=async()=>{const s=t.orderUserId,d={orderId:n.orderId,userId:s,approvalStatus:2};try{const o=await I.patch("/api/user/user-payment-member",d,{headers:{Authorization:`Bearer ${p}`}});x(!1),u.fire({title:"결제가 거절되었습니다.",icon:"error",confirmButtonText:"확인",allowOutsideClick:!1})}catch(o){console.log(o)}},N=s=>{h(`/user/placetoorder/member/${s}`,{state:{orderId:s}}),C(s),m(!1)},c=s=>{console.log("데이터 불러오기",s),f({...s})};return console.log(a),console.log(n),e.jsxs("div",{className:"absolute top-12 right-5 w-[80%] bg-white z-50 border-2 border-darkGray rounded-md pb-4 overflow-x-hidden over overflow-y-scroll scrollbar-hide",children:[e.jsx("div",{className:"p-5 font-semibold text-darkGray",children:"알림"}),e.jsxs("div",{className:"flex flex-col px-5 gap-5 font-medium text-nowrap",children:[(a==null?void 0:a.length)>0?a.map(s=>e.jsx("div",{onClick:()=>{s.message==="나한테 온 승인요청 메세지"?(i(s),x(!0)):N(s.orderId)},className:"flex w-full h-[10%]",children:s.message==="나한테 온 승인요청 메세지"?e.jsx(e.Fragment,{children:e.jsx("span",{className:"font-bold cursor-pointer",onClick:()=>c(s),children:s.message})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2 items-center cursor-pointer",children:[e.jsx("span",{className:"text-black text-xl",children:s.restaurantName}),e.jsx("span",{className:"text-darkGray",children:"주문을 완성해주세요"})]})})},s.orderId)):e.jsx("span",{className:"text-darkGray tracking-wide",children:"새로운 알림이 없습니다"}),w?e.jsx("div",{className:"w-full h-dvh overflow-hidden fixed top-0 left-0 bg-darkGray bg-opacity-70 flex justify-center items-center text-center z-10",children:e.jsxs("div",{onClick:s=>s.stopPropagation(),className:"absolute top-40 left-1/6 w-[340px] h-[280px] z-50 bg-white border-2 border-darkGray rounded-lg border-opacity-30 overflow-x-hidden overflow-y-scroll scrollbar-hide",children:[e.jsx("div",{className:"relative flex w-full h-[20%]",children:e.jsxs("div",{className:"absolute top-0 left-0 flex w-full h-full justify-between items-center px-5 border-b-2 border-gray",children:[e.jsxs("span",{className:"font-medium text-2xl",children:[t==null?void 0:t.orderUserName,"님의 승인 요청"]}),e.jsx(G,{onClick:()=>x(!1),className:"font-semibold size-6"})]})}),e.jsxs("div",{className:"flex w-full h-[85%] flex-col py-4 gap-3",children:[e.jsx("span",{className:"text-xl",children:t==null?void 0:t.restaurantName}),e.jsxs("span",{className:"text-2xl",children:[(l=t==null?void 0:t.point)==null?void 0:l.toLocaleString("ko-KR")," 원"]}),e.jsx("span",{className:"text-xl",children:"결제를 승인하시겠습니까?"}),e.jsxs("div",{className:"flex w-full justify-center items-center gap-10 mt-4",children:[e.jsx("span",{onClick:()=>A(),className:"px-3 py-1 bg-blue text-white rounded-sm ",children:"승인"}),e.jsx("span",{onClick:()=>g(),className:"px-3 py-1 bg-red text-white rounded-sm ",children:"거절"})]})]})]})}):e.jsx("div",{})]})]})},q=()=>{const[k,C]=r(E),[a,y]=r(S),[t,f]=r(L),[O,m]=r(R),[n,b]=r(P),[w,x]=r($),h=sessionStorage.getItem("userId"),p=B();r(z);const v=u.mixin({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,timerProgressBar:!0,didOpen:i=>{i.onmouseenter=u.stopTimer,i.onmouseleave=u.resumeTimer}});return j.useEffect(()=>{const i={userId:h};(async()=>{var g,N;if(w===!0)try{const c=await I.get("/api/user/alert",{params:i,headers:{Authorization:`Bearer ${p}`}});console.log(c.data.resultData);const l=c.data.resultData;(g=l[0])!=null&&g.orderId?(y(l),console.log("결제 승인 요청이 왔습니다"),f(!0),v.fire({title:"결제 승인 요청이 왔습니다!",text:"알림 메세지를 확인해주세요",icon:"info",customClass:{popup:"flex w-[90%]",title:"text-2xl"}})):(N=l[1])!=null&&N.orderId?(y(l),m(!0)):l.length===0&&(f(!1),m(!1))}catch(c){console.log(c)}})()},[]),console.log(a),e.jsxs("div",{children:[e.jsx("div",{children:e.jsxs("div",{onClick:()=>b(!n),className:"absolute right-5 top-5 z-50 cursor-pointer",children:[a.length!==0?e.jsx(U,{className:"absolute -right-0 -top-1 text-xs text-red animate-ping"}):e.jsx(e.Fragment,{}),e.jsx(M,{className:`size-6 ${k?"text-white":"text-black"}`})]})}),n?e.jsx(W,{}):e.jsx(e.Fragment,{})]})};export{q as N};
