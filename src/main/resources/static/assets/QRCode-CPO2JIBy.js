import{R as v,aj as D,ak as E,h as H,c as n,u as S,X as C,W as A,e as f,f as Q,j as t,D as T}from"./index-CQbk2HOI.js";import{Q as W}from"./index-DEDMgCo3.js";import{M as z}from"./MenuBar-xsBcDoCC.js";import"./index-BUmomptc.js";import"./index-kw6KE48s.js";const G=()=>{var m,h,p;const[c,g]=v(D),[a,k]=v(E),u=H(),j=sessionStorage.getItem("userId"),[x,w]=n.useState({couponW:0,visualH:0,infoH:0}),[B,$]=n.useState(0),I=S(),N=C(),{id:b}=A(),o=n.useRef(null),l=n.useRef(null),y=()=>{const s=o.current,e=s.clientWidth,i=l.current,r=s.clientHeight,d=i.clientHeight;s.style.clipPath=`path('M0 0 L0 ${r-10} Q10 ${r-10} 10 ${r} L ${e-10} ${r} Q${e-10} ${r-10} ${e} ${r-10} L${e} 0 Z')`,i.style.clipPath=`path('M10 0 Q10 10 0 10 L0 ${d} L${e} ${d} L${e} 10 Q${e-10} 10 ${e-10} 0 Z')`};n.useLayoutEffect(()=>{x.couponW>0&&requestAnimationFrame(()=>{y()})},[x]),n.useEffect(()=>{const s=()=>{o.current&&l.current&&w({couponW:o.current.clientWidth,visualH:o.current.clientHeight,infoH:l.current.clientHeight})};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),n.useEffect(()=>{(!c||c<=0)&&L()},[]),n.useEffect(()=>{c&&c>0&&R(c)},[c]);const L=async()=>{const s={userId:j};try{const e=await f.get("/api/order/ticket/ticketOne",{params:s,headers:{Authorization:`Bearer ${u}`}});console.log("API 응답:",e.data);const i=e.data.resultData;i?g(i):console.warn("유효한 티켓 ID가 없습니다.")}catch(e){console.error("티켓 ID를 가져오는 중 오류 발생:",e)}},R=async s=>{try{const e=await f.get("/api/order/ticket",{params:{ticketId:s},headers:{Authorization:`Bearer ${u}`}});console.log("티켓 데이터 : ",e.data.resultData.ticket),k(e.data.resultData.ticket)}catch(e){console.error("티켓 데이터를 가져오는 중 오류 발생:",e),alert("티켓 정보를 가져오는 중 오류가 발생했습니다. 다시 시도해주세요.")}};return n.useEffect(()=>{const s=setInterval(async()=>{const e={ticketId:c};try{const r=(await f.get("/api/order/ticket",{params:e,headers:{Authorization:`Bearer ${u}`}})).data.resultData.ticket;console.log(r.ticketStatus),r.ticketStatus===1&&($(1),clearInterval(s),Q.fire({title:"식권이 사용되었어요",icon:"success",confirmButtonText:"확인",allowOutsideClick:!1}).then(d=>{d.isConfirmed&&I("/user")}))}catch(i){console.error("티켓 상태 조회 실패:",i)}},3e3);return()=>clearInterval(s)},[c]),t.jsxs("div",{className:"flex flex-col w-full h-dvh px-10 pt-20 overflow-x-hidden overflow-y-scroll scrollbar-hide",children:[t.jsx("section",{id:"visual",ref:o,children:t.jsxs("div",{className:"gap-4 pb-4 flex flex-col items-center justify-center bg-gray rounded-t-2xl border-b-4 border-dotted border-darkGray",children:[t.jsx("div",{className:"w-full text-center bg-primary rounded-t-2xl p-6 text-white font-bold",children:t.jsx("span",{className:"font-bold text-4xl text-nowrap",children:a.restaurantName})}),t.jsxs("div",{className:"flex flex-col w-full items-center",children:[t.jsx("span",{className:"text-base -ml-44 text-nowrap",children:"식권 발급 시간"}),t.jsxs("div",{className:"flex text-2xl text-center font-semibold gap-8",children:[t.jsx("span",{className:"flex tracking-widest",children:(m=a==null?void 0:a.reservationTime)==null?void 0:m.split(" ")[0]}),t.jsx("span",{className:"flex tracking-widest",children:(p=(h=a==null?void 0:a.reservationTime)==null?void 0:h.split(" ")[1])==null?void 0:p.slice(0,5)})]})]}),t.jsxs("div",{className:"flex flex-col w-full items-center gap-2",children:[t.jsx("span",{className:"text-2xl",children:a.menuNames}),t.jsxs("span",{className:"text-4xl font-bold tracking-wider",children:[a.totalAmount.toLocaleString("ko-KR"),"원"]}),t.jsxs("span",{className:"text-xl",children:[a.personCount,"명 결제"]})]})]})}),t.jsx("section",{id:"info",ref:l,children:t.jsx("div",{className:"p-10 flex flex-col justify-center items-center bg-gray rounded-b-2xl",children:t.jsx("div",{className:"flex w-full justify-center items-center ",children:t.jsx(W,{value:`${T}/store/request?ticketId=${b}&restaurantId=${N.state.restaurantId}`,size:180,bgColor:"none"})})})}),t.jsx("div",{className:"text-xl underline text-center mt-10 pb-16",children:"예약 취소는 매장으로 문의해주세요"}),t.jsx(z,{})]})};export{G as default};
